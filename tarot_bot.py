import os
import random
import logging
from PIL import Image
from telegram import Update
from telegram.ext import (
    Application,
    CommandHandler,
    MessageHandler,
    filters,
    CallbackContext
)

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO
)
logger = logging.getLogger(__name__)

# –°–ª–æ–≤–∞—Ä—å –∑–Ω–∞—á–µ–Ω–∏–π –∫–∞—Ä—Ç
TAROT_MEANINGS = {
            "00": {"name": "–®—É—Ç", "meaning": "–Ω–æ–≤–æ–µ –Ω–∞—á–∏–Ω–∞–Ω–∏–µ, –¥–æ–≤–µ—Ä–∏–µ –º–∏—Ä—É, –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω—ã–π –ø—É—Ç—å, –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫, –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —á–∏—Å—Ç–æ—Ç–∞, –Ω–∞—á–∞–ª–æ –ø—É—Ç–∏, —É—á–µ–Ω–∏—á–µ—Å—Ç–≤–æ, –∏–º–ø—É–ª—å—Å, —Ä–æ–∂–¥–µ–Ω–∏–µ –≤–µ—Ä—ã.", "reversed": "—Å—Ç—Ä–∞—Ö –ø–µ—Ä–µ–º–µ–Ω, —É—Ö–æ–¥ –æ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏, –∑–∞–±–≤–µ–Ω–∏–µ –¥–∞—Ä–∞, –æ—Ç–∫–∞–∑ –æ—Ç —Å–µ–±—è –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ, —Å–æ–º–Ω–µ–Ω–∏—è, —á—Ä–µ–∑–º–µ—Ä–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø–æ—Ç–µ—Ä—è —Å–≤—è–∑–∏ —Å –∏–Ω—Ç—É–∏—Ü–∏–µ–π"},
            "01": {"name": "–ú–∞–≥", "meaning": "–ù–∞—Å—Ç–æ—è—â–µ–µ –∑–Ω–∞–Ω–∏–µ, –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω–æ–µ –≤—Ä–µ–º–µ–Ω–µ–º, –û–ø—ã—Ç –∏ —É–º–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω—è—Ç—å —Å–∏–ª—É —Ç–æ—á–Ω–æ –∏ —Å–ø–æ–∫–æ–π–Ω–æ. –ú–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ –±–µ–∑ –ø–æ–∫–∞–∑–Ω–æ–≥–æ –≤–µ–ª–∏—á–∏—è. –ú–∞–≥–∏—è, –≤–ø–ª–µ—Ç—ë–Ω–Ω–∞—è –≤ –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–æ—Å—Ç—å, –ö–æ–Ω—Ç—Ä–æ–ª—å —á–µ—Ä–µ–∑ –º—É–¥—Ä–æ—Å—Ç—å, –∞ –Ω–µ —á–µ—Ä–µ–∑ —Å–∏–ª—É. –¢–∞–ª–∞–Ω—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è. –¢–∞–Ω–¥–µ–º, –≤ –∫–æ—Ç–æ—Ä–æ–º –¥–∞–∂–µ —Ç—å–º–∞ —É—á–∏—Ç—Å—è –±—ã—Ç—å —Å–≤–µ—Ç–æ–º. –£–¥–∞—á–Ω—ã–π —Å–æ—é–∑ –ª–æ–≥–∏–∫–∏ –∏ –∏–Ω—Ç—É–∏—Ü–∏–∏", "reversed": "–ú–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏ –ø–æ–¥ –º–∞—Å–∫–æ–π –∑–Ω–∞–Ω–∏—è. –ñ–µ–ª–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å ‚Äî –∏–∑ —Å—Ç—Ä–∞—Ö–∞. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∏–ª—ã —Ä–∞–¥–∏ –≤—ã–≥–æ–¥—ã, –∞ –Ω–µ –∏—Å—Ç–∏–Ω—ã. –û—Ç–∫–∞–∑ –æ—Ç –ø–µ—Ä–µ–º–µ–Ω, –∫–æ–≥–¥–∞ –æ–Ω–∏ –Ω–∞–∑—Ä–µ–ª–∏. –ü—Ä–∏–≤—ã—á–∫–∞ –∑–∞—Ä—ã–≤–∞—Ç—å—Å—è –≤ —Ä—É—Ç–∏–Ω—É –≤–º–µ—Å—Ç–æ –¥–µ–π—Å—Ç–≤–∏—è. –õ–æ–∂–Ω–æ–µ —á—É–≤—Å—Ç–≤–æ ¬´–≤—Å—ë –ø–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º¬ª. –°—Ç—Ä–∞—Ö –ø–µ—Ä–µ–¥ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º –¥–∞—Ä–æ–º."},
            "02": {"name": "–í–µ—Ä—Ö–æ–≤–Ω–∞—è –ñ—Ä–∏—Ü–∞", "meaning": "–ú–æ–ª—á–∞–ª–∏–≤–æ–µ –∑–Ω–∞–Ω–∏–µ. –ò–Ω—Ç—É–∏—Ü–∏—è, –ø—Ä–∏—à–µ–¥—à–∞—è –∏–∑ –≥–ª—É–±–∏–Ω—ã –≤–µ–∫–æ–≤. –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–∏–∫–æ—Å–Ω—É—Ç—å—Å—è –∫ –∑–∞–ø—Ä–µ—Ç–Ω–æ–º—É, –Ω–µ –Ω–∞—Ä—É—à–∏–≤ –±–∞–ª–∞–Ω—Å–∞. –°–æ—é–∑ —Å –ø–æ—Ç—É—Å—Ç–æ—Ä–æ–Ω–Ω–∏–º ‚Äî –±–µ–∑ —Å—Ç—Ä–∞—Ö–∞, –Ω–æ —Å —É–≤–∞–∂–µ–Ω–∏–µ–º. –ñ–µ–Ω—Å–∫–∞—è —Å–∏–ª–∞, –Ω–µ —Ç—Ä–µ–±—É—é—â–∞—è –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤. –ü–æ—è–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ –¥—Ä—É–≥–∞, —Å–∫—Ä—ã—Ç–æ–≥–æ —Å–æ—é–∑–Ω–∏–∫–∞ –∏–ª–∏ –¢–µ–Ω–∏, —á—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç", "reversed": "–ü—Å–µ–≤–¥–æ–º—É–¥—Ä–æ—Å—Ç—å –∏ –¥—É—Ö–æ–≤–Ω—ã–π –ø–∞—Ñ–æ—Å. –ú–∞–Ω–∏–ø—É–ª—è—Ü–∏—è –∑–Ω–∞–Ω–∏—è–º–∏ —Ä–∞–¥–∏ –≤–ª–∞—Å—Ç–∏. –ò–∑–æ–ª—è—Ü–∏—è –æ—Ç –º–∏—Ä–∞ –∏ –ª—é–¥–µ–π. –°–æ–∫—Ä—ã—Ç–∏–µ –ø—Ä–∞–≤–¥—ã, –∫–æ—Ç–æ—Ä–∞—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ–∑–≤—É—á–µ–Ω–∞. –û–ø–∞—Å–Ω–∞—è —Ç—è–≥–∞ –∫ –∑–∞–ø—Ä–µ—Ç–Ω–æ–º—É –±–µ–∑ –¥–æ–ª–∂–Ω–æ–≥–æ —É–≤–∞–∂–µ–Ω–∏—è."},
            "03": {"name": "–ò–º–ø–µ—Ä–∞—Ç—Ä–∏—Ü–∞", "meaning": "–≤–ª–∞—Å—Ç—å, –æ–±—Ä–µ—Ç—ë–Ω–Ω–∞—è —á–µ—Ä–µ–∑ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ —Å–µ–±–µ –∏ –ø—Ä–∏—Ä–æ–¥–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã. –ñ–µ–Ω—Å–∫–∞—è —ç–Ω–µ—Ä–≥–∏—è, —Å–ø–æ—Å–æ–±–Ω–∞—è –Ω–µ—Å—Ç–∏ –∫–∞–∫ —Å–æ–∑–∏–¥–∞–Ω–∏–µ, —Ç–∞–∫ –∏ —Ä–∞–∑—Ä—É—à–µ–Ω–∏–µ. –ü–æ—è–≤–ª–µ–Ω–∏–µ –º–æ–≥—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–æ—é–∑–Ω–∏–∫–∞. –£–º–µ–Ω–∏–µ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∏ –Ω–∞–ø—Ä–∞–≤–ª—è—Ç—å. –ü–ª–æ–¥–æ—Ä–æ–¥–∏–µ –∏–¥–µ–π. –ò—Å–∫—É—à–µ–Ω–∏–µ –∫–∞–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∞ –Ω–µ —Å–ª–∞–±–æ—Å—Ç—å.", "reversed": "–∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –≤–ª–∞—Å—Ç—å—é. –°–æ–±–ª–∞–∑–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ—Å—É—Ä—Å—ã –≤ —ç–≥–æ–∏—Å—Ç–∏—á–Ω—ã—Ö —Ü–µ–ª—è—Ö. –ò–ª–ª—é–∑–∏—è –∫–æ–Ω—Ç—Ä–æ–ª—è. –ü—Ä–µ–Ω–µ–±—Ä–µ–∂–µ–Ω–∏–µ –ø—Ä–µ–¥–µ–ª–∞–º–∏ –¥–æ–∑–≤–æ–ª–µ–Ω–Ω–æ–≥–æ"},
            "04": {"name": "–ò–º–ø–µ—Ä–∞—Ç–æ—Ä", "meaning": "–í–ª–∞—Å—Ç—å, —Ö–∞—Ä–∏–∑–º–∞, –ª–∏–¥–µ—Ä—Å—Ç–≤–æ. –ö–æ–Ω—Ç—Ä–æ–ª—å, –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏. –£—Å–ø–µ—Ö, –Ω–æ –∑–∞ —Å—á—ë—Ç –¥—Ä—É–≥–∏—Ö. –ú–∞–≥ —Å–∏–ª—ã, –Ω–æ –Ω–µ –¥–æ–±—Ä–∞", "reversed": "–û–±–º–∞–Ω, –¥–µ—Å–ø–æ—Ç–∏–∑–º. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –≤–Ω–µ—à–Ω–µ–π —Å–∏–ª—ã. –ö—Ä–∞—Ö –∞–º–±–∏—Ü–∏–π. –ë—É–Ω—Ç –ø—Ä–æ—Ç–∏–≤ –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç–æ–≤. –ö–∞–ø–∫–∞–Ω –≥–æ—Ä–¥—ã–Ω–∏."},
            "05": {"name": "–ò–µ—Ä–æ—Ñ–∞–Ω—Ç", "meaning": "–ì–ª—É–±–æ–∫–∞—è –¥—É—Ö–æ–≤–Ω–æ—Å—Ç—å –±–µ–∑ –¥–æ–≥–º—ã. –ü–æ–¥–ª–∏–Ω–Ω–∞—è –≤–µ—Ä–∞, –∂–∏–≤—É—â–∞—è –≤ –¥–µ–π—Å—Ç–≤–∏—è—Ö, –∞ –Ω–µ –≤ —Å–ª–æ–≤–∞—Ö. –°–ª—É–∂–µ–Ω–∏–µ ‚Äî –¥–æ–±—Ä–æ–≤–æ–ª—å–Ω–æ–µ –∏ –∏—Å–∫—Ä–µ–Ω–Ω–µ–µ. –ü–æ–º–æ—â—å —Ç–µ–º, –∫—Ç–æ –Ω–µ –º–æ–∂–µ—Ç —Å–∞–º —Å–µ–±—è –∑–∞—â–∏—Ç–∏—Ç—å. –ü—Ä–∏–∑–≤–∞–Ω–∏–µ, –∑–∞ –∫–æ—Ç–æ—Ä—ã–º –Ω–µ —Å—Ç–æ–∏—Ç —Ç—â–µ—Å–ª–∞–≤–∏–µ. –ê–Ω–≥–µ–ª—å—Å–∫–∞—è –∑–∞—â–∏—Ç–∞ ‚Äî —è–≤–Ω–∞—è –∏–ª–∏ –Ω–µ–≤–∏–¥–∏–º–∞—è. –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏—Å—Ü–µ–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ —Å–æ—Å—Ç—Ä–∞–¥–∞–Ω–∏–µ –∏ –ª—é–±–æ–≤—å. –í—Å—Ç—Ä–µ—á–∞ —Å –ß–µ–ª–æ–≤–µ–∫–æ–º –°–≤–µ—Ç–∞ ‚Äî —Ç–∏—Ö–∏–º, –Ω–æ —Å—É–¥—å–±–æ–Ω–æ—Å–Ω—ã–º.", "reversed": "–ü–æ–¥–º–µ–Ω–∞ –≤–µ—Ä—ã ‚Äî —Ä–∏—Ç—É–∞–ª–æ–º, —Ñ–æ—Ä–º—ã ‚Äî —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ–º. –ñ–µ—Å—Ç–∫–æ—Å—Ç—å —Ç–∞–º, –≥–¥–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –º—è–≥–∫–æ—Å—Ç—å. –ü—Ä–∏–Ω—è—Ç–∏–µ –Ω–∞ —Å–µ–±—è ¬´–±–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–π —Ä–æ–ª–∏¬ª –±–µ–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –∑—Ä–µ–ª–æ—Å—Ç–∏. –ù–µ–∂–µ–ª–∞–Ω–∏–µ —Å–ª—ã—à–∞—Ç—å –∏–ª–∏ –±—ã—Ç—å —É—Å–ª—ã—à–∞–Ω–Ω—ã–º. –ü–æ–¥–∞–≤–ª–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Å–≤–µ—Ç–∞ –ø–æ–¥ –¥–∞–≤–ª–µ–Ω–∏–µ–º —á—É–∂–∏—Ö –Ω–æ—Ä–º"},
            "06": {"name": "–í–ª—é–±–ª–µ–Ω–Ω—ã–µ", "meaning": "–õ—é–±–æ–≤—å, –≥–∞—Ä–º–æ–Ω–∏—è, –æ—Ç–Ω–æ—à–µ–Ω–∏—è", "reversed": "–î–∏—Å–±–∞–ª–∞–Ω—Å, –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã, –Ω–µ–≤–µ—Ä–Ω–æ—Å—Ç—å"},
            "07": {"name": "–ö–æ–ª–µ—Å–Ω–∏—Ü–∞", "meaning": "–ü–æ–±–µ–¥–∞, –≤–æ–ª—è, –¥–≤–∏–∂–µ–Ω–∏–µ –≤–ø–µ—Ä–µ–¥", "reversed": "–ü–æ—Ç–µ—Ä—è –∫–æ–Ω—Ç—Ä–æ–ª—è, –∑–∞–¥–µ—Ä–∂–∫–∏, –ø–æ—Ä–∞–∂–µ–Ω–∏–µ"},
            "08": {"name": "–°–∏–ª–∞", "meaning": "–ú—É–∂–µ—Å—Ç–≤–æ, —Å–æ—Å—Ç—Ä–∞–¥–∞–Ω–∏–µ, –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å–∏–ª–∞", "reversed": "–°–ª–∞–±–æ—Å—Ç—å, –Ω–µ—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —Å–∏–ª–æ–π"},
            "09": {"name": "–û—Ç—à–µ–ª—å–Ω–∏–∫", "meaning": "–°–æ–∑–µ—Ä—Ü–∞–Ω–∏–µ, –ø–æ–∏—Å–∫ –∏—Å—Ç–∏–Ω—ã, —É–µ–¥–∏–Ω–µ–Ω–∏–µ", "reversed": "–û–¥–∏–Ω–æ—á–µ—Å—Ç–≤–æ, –∏–∑–æ–ª—è—Ü–∏—è, –æ—Ç–∫–∞–∑ –æ—Ç –ø–æ–º–æ—â–∏"},
            "10": {"name": "–ö–æ–ª–µ—Å–æ –§–æ—Ä—Ç—É–Ω—ã", "meaning": "–°—É–¥—å–±–∞, —É–¥–∞—á–∞, —Ü–∏–∫–ª–∏—á–Ω–æ—Å—Ç—å", "reversed": "–ù–µ—É–¥–∞—á–∞, —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–∞–º"},
            "11": {"name": "–°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å", "meaning": "–ë–∞–ª–∞–Ω—Å, —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å, –ø—Ä–∞–≤–¥–∞", "reversed": "–ù–µ—Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å, –ø—Ä–µ–¥–≤–∑—è—Ç–æ—Å—Ç—å, –±–µ–∑–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å"},
            "12": {"name": "–ü–æ–≤–µ—à–µ–Ω–Ω—ã–π", "meaning": "–ñ–µ—Ä—Ç–≤–∞, —Å–¥–∞—á–∞, –Ω–æ–≤—ã–π –≤–∑–≥–ª—è–¥", "reversed": "–ë–µ—Å–ø–æ–ª–µ–∑–Ω—ã–µ –∂–µ—Ä—Ç–≤—ã, –∑–∞—Å—Ç–æ–π, —ç–≥–æ–∏–∑–º"},
            "13": {"name": "–°–º–µ—Ä—Ç—å", "meaning": "–ö–æ–Ω–µ—Ü, —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è, –Ω–æ–≤–æ–µ –Ω–∞—á–∞–ª–æ", "reversed": "–°–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º, —Å—Ç—Ä–∞—Ö, –∑–∞—Å—Ç–æ–π"},
            "14": {"name": "–£–º–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å", "meaning": "–ì–∞—Ä–º–æ–Ω–∏—è, —Ç–µ—Ä–ø–µ–Ω–∏–µ, –±–∞–ª–∞–Ω—Å", "reversed": "–î–∏—Å–±–∞–ª–∞–Ω—Å, –∫—Ä–∞–π–Ω–æ—Å—Ç–∏, –Ω–µ—Ç–µ—Ä–ø–µ–Ω–∏–µ"},
            "15": {"name": "–î—å—è–≤–æ–ª", "meaning": "–ò–ª–ª—é–∑–∏—è, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å, –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–º", "reversed": "–û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ, –ø—Ä–µ–æ–¥–æ–ª–µ–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π"},
            "16": {"name": "–ë–∞—à–Ω—è", "meaning": "–ö—Ä–∞—Ö, –æ—Ç–∫—Ä–æ–≤–µ–Ω–∏–µ, –≤–Ω–µ–∑–∞–ø–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è", "reversed": "–ò–∑–±–µ–≥–∞–Ω–∏–µ –ø—Ä–∞–≤–¥—ã, —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º"},
            "17": {"name": "–ó–≤–µ–∑–¥–∞", "meaning": "–ù–∞–¥–µ–∂–¥–∞, –≤–µ—Ä–∞, –¥—É—Ö–æ–≤–Ω–æ–µ –ø—Ä–æ—Å–≤–µ—Ç–ª–µ–Ω–∏–µ", "reversed": "–û—Ç—á–∞—è–Ω–∏–µ, –ø–µ—Å—Å–∏–º–∏–∑–º, –ø–æ—Ç–µ—Ä—è –≤–µ—Ä—ã"},
            "18": {"name": "–õ—É–Ω–∞", "meaning": "–ò–ª–ª—é–∑–∏—è, —Å—Ç—Ä–∞—Ö, –ø–æ–¥—Å–æ–∑–Ω–∞–Ω–∏–µ", "reversed": "–Ø—Å–Ω–æ—Å—Ç—å, –ø—Ä–µ–æ–¥–æ–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ö–æ–≤"},
            "19": {"name": "–°–æ–ª–Ω—Ü–µ", "meaning": "–†–∞–¥–æ—Å—Ç—å, —É—Å–ø–µ—Ö, –∂–∏–∑–Ω–µ–Ω–Ω–∞—è —Å–∏–ª–∞", "reversed": "–í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏, –∑–∞–¥–µ—Ä–∂–∫–∏"},
            "20": {"name": "–°—É–¥", "meaning": "–í–æ–∑—Ä–æ–∂–¥–µ–Ω–∏–µ, –ø—Ä–∏–∑—ã–≤, –ø—Ä–æ—â–µ–Ω–∏–µ", "reversed": "–°–æ–º–Ω–µ–Ω–∏—è, —Å—Ç—Ä–∞—Ö –ø–µ—Ä–µ–º–µ–Ω, —Å–∞–º–æ–æ–±–≤–∏–Ω–µ–Ω–∏–µ"},
            "21": {"name": "–ú–∏—Ä", "meaning": "–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ, –µ–¥–∏–Ω—Å—Ç–≤–æ, –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ", "reversed": "–ù–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ—Å—Ç—å, –∑–∞–¥–µ—Ä–∂–∫–∏, —Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω–∏–µ"}
           }


class TarotBot:
    def __init__(self, token: str, cards_folder: str):
        self.token = token
        self.cards_folder = cards_folder

    async def start(self, update: Update, context: CallbackContext) -> None:
        """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start"""
        keyboard = [["üîÆ –í—ã—Ç—è–Ω—É—Ç—å –∫–∞—Ä—Ç—É"]]
        reply_markup = {"keyboard": keyboard, "resize_keyboard": True}
        
        await update.message.reply_text(
            "‚ú® *–¢–∞—Ä–æ-–±–æ—Ç: –ì–∞–¥–∞–Ω–∏–µ –Ω–∞ –æ–¥–Ω–æ–π –∫–∞—Ä—Ç–µ*\n\n"
            "–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ /card",
            reply_markup=reply_markup,
            parse_mode="Markdown"
        )

    async def send_card(self, update: Update, context: CallbackContext) -> None:
        """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–¥–Ω—É —Å–ª—É—á–∞–π–Ω—É—é –∫–∞—Ä—Ç—É"""
        try:
            card_file = random.choice(os.listdir(self.cards_folder))
            is_reversed = random.choice([True, False])
            card_path = os.path.join(self.cards_folder, card_file)
            
            with Image.open(card_path) as img:
                if is_reversed:
                    img = img.rotate(180)
                
                temp_path = "temp_card.jpg"
                img.save(temp_path, "JPEG")
                
                card_num = card_file.split('_')[0]
                card_info = TAROT_MEANINGS.get(card_num, {
                    "name": "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–∞—Ä—Ç–∞",
                    "meaning": "–ó–Ω–∞—á–µ–Ω–∏–µ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ",
                    "reversed": "–ü–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"
                })
                
                caption = (
                    f"*{card_info['name']}* {'(–ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç–∞)' if is_reversed else ''}\n\n"
                    f"üîÆ *–ó–Ω–∞—á–µ–Ω–∏–µ:*\n"
                    f"{card_info['reversed' if is_reversed else 'meaning']}\n\n"
                    f"–ù–∞–∂–º–∏—Ç–µ /card –¥–ª—è –Ω–æ–≤–æ–π –∫–∞—Ä—Ç—ã"
                )
                
                with open(temp_path, 'rb') as photo:
                    await update.message.reply_photo(
                        photo=photo,
                        caption=caption,
                        parse_mode="Markdown"
                    )
            
            os.remove(temp_path)
            
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞: {str(e)}", exc_info=True)
            await update.message.reply_text("‚ö†Ô∏è –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.")

    def run(self):
        """–ó–∞–ø—É—Å–∫–∞–µ—Ç –±–æ—Ç–∞"""
        application = Application.builder().token(self.token).build()
        
        application.add_handler(CommandHandler("start", self.start))
        application.add_handler(CommandHandler("card", self.send_card))
        application.add_handler(MessageHandler(filters.Regex(r'^üîÆ –í—ã—Ç—è–Ω—É—Ç—å –∫–∞—Ä—Ç—É$'), self.send_card))
        
        application.run_polling()

if __name__ == '__main__':
    TOKEN = os.environ.get('BOT_TOKEN')
    CARDS_FOLDER = "cards"
    
    if not os.path.exists(CARDS_FOLDER):
        logger.error(f"–ü–∞–ø–∫–∞ —Å –∫–∞—Ä—Ç–∞–º–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞: {os.path.abspath(CARDS_FOLDER)}")
        exit(1)
    
    bot = TarotBot(TOKEN, CARDS_FOLDER)
    bot.run()
